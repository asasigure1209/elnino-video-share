# エルニーニョ動画配布サイト 実装工程表（機能ベース）

Claudeで工程表を作成

## Phase 1: 環境構築・基盤整備（1-2日）

### 1.1 プロジェクトセットアップ

- [x] Git リポジトリの作成
- [x] Next.js プロジェクトの初期化
- [x] TypeScript の設定
- [x] Biome の設定
- [x] 必要なライブラリのインストール
    - Tailwind CSS（UI）
    - vitest
- [x] GitHub Actions の整備
  - [x] PRのVitest実行
  - [x] PRのリントチェック
- [x] FSD（Feature-Sliced Design）アーキテクチャの導入
  - [x] Next.js App Router + FSD の統合構造構築
  - [x] src/pages/, src/widgets/, src/features/, src/entities/, src/shared/ レイヤー作成
  - [x] Pages Router 無効化とドキュメント整備
- [x] (必要になった実装のタイミングで)ライブラリのインストール
    - [x] Google Sheets API関連ライブラリ
    - [ ] Cloudflare R2 SDK

### 1.2 外部サービス連携準備

- [x] Google Sheets API の有効化・認証設定
- [ ] Cloudflare R2 バケットの作成・設定
- [x] 環境変数の設定（.env.local）

### 1.3 データベース設計実装

- [x] Google スプレッドシートの作成
    - [x] players シート
    - [x] videos シート
    - [x] player_videos シート
- [x] 基本的な型定義（Player, Video, PlayerVideo）

## Phase 2: 共通機能・基盤コンポーネント（2日）

### 2.1 共通データアクセス層

- [x] Google Sheets 接続・認証ヘルパー
- [ ] Cloudflare R2 接続・認証ヘルパー
- [x] 基本的なCRUD操作関数のベース実装

### 2.2 UI基盤コンポーネント

- [ ] レイアウトコンポーネント（Header, Footer）
- [ ] ローディング・エラー表示コンポーネント
- [ ] ボタン、カード、モーダルなどの基本UIコンポーネント
- [ ] middleware.ts でのBasic認証実装

## Phase 3: プレイヤー一覧機能（TOPページ）（2日）

### 3.1 バックエンド実装

- [x] Server Component でのプレイヤーデータフェッチ実装
    - [x] Google Sheetsからプレイヤー一覧取得
    - [x] エラーハンドリング・キャッシュ設定

### 3.2 フロントエンド実装

- [x] `/` TOPページ実装（モックアップは`requirements/mockups/index.png`）
    - [x] プレイヤー一覧表示
    - [x] エントリーNo、プレイヤー名表示
    - [x] プレイヤー詳細ページへのリンク
- [x] レスポンシブ対応
- [x] ローディング・エラー状態の実装

### 3.3 統合テスト

- [ ] エンドツーエンドでの動作確認
- [x] Google Sheets連携テスト

## Phase 4: プレイヤー詳細・動画一覧機能（2-3日）

### 4.1 バックエンド実装

- [ ] Server Component での動画データフェッチ実装
    - 特定プレイヤーの動画一覧取得
    - プレイヤー-動画の紐付け処理
- [ ] Cloudflare R2 からの動画ダウンロードURL生成
- [ ] 動画ファイル存在チェック・キャッシュ設定

### 4.2 フロントエンド実装

- [ ] `/players/[id]` プレイヤー詳細ページ実装
    - プレイヤー情報表示
    - 動画一覧表示（動画名、種類）
    - ダウンロードリンク実装
- [ ] 動画タイプ別の表示（予選、TOP16等）
- [ ] ダウンロード進捗・エラー処理

### 4.3 統合テスト

- [ ] 動画ダウンロード機能テスト
- [ ] 各種動画タイプでの動作確認

## Phase 5: 管理者ダッシュボード（1日）

### 5.1 認証機能強化

- [ ] middleware.ts でのBasic認証の実装・テスト
- [ ] /admin パスへのアクセス制御

### 5.2 管理者トップページ

- [ ] `/admin` 管理者ダッシュボード実装
    - プレイヤー管理へのナビゲーション
    - 動画管理へのナビゲーション
    - システム状態表示（登録数など）

## Phase 6: プレイヤー管理機能（2-3日）

### 6.1 プレイヤー一覧・削除機能

- [ ] 管理者用プレイヤーデータフェッチ（Server Component）
- [ ] プレイヤー削除 Server Action 実装
- [ ] `/admin/players` プレイヤー管理ページ実装
    - プレイヤー一覧表示
    - 削除ボタン・確認ダイアログ
    - 作成・編集ページへのリンク

### 6.2 プレイヤー作成機能

- [ ] プレイヤー作成 Server Action 実装
- [ ] `/admin/players/new` プレイヤー作成ページ実装
    - フォーム実装（Server Actions + useFormState）
    - バリデーション・エラー表示

### 6.3 プレイヤー編集機能

- [ ] プレイヤー更新 Server Action 実装
- [ ] `/admin/players/[id]/edit` プレイヤー編集ページ実装
    - 既存データの読み込み
    - 更新フォーム実装

### 6.4 統合テスト

- [ ] CRUD操作の全体テスト
- [ ] エラーケースの確認

## Phase 7: 動画管理機能（3-4日）

### 7.1 動画一覧・削除機能

- [ ] 管理者用動画データフェッチ（Server Component）
- [ ] 動画削除 Server Action 実装
    - R2からのファイル削除も含む
- [ ] `/admin/videos` 動画管理ページ実装
    - 動画一覧表示（動画名、タイプ、紐付きプレイヤー）
    - 削除ボタン・確認ダイアログ

### 7.2 動画登録機能

- [ ] 動画登録 Server Action 実装
    - ファイルアップロード処理
    - R2への保存
    - メタデータの保存
- [ ] `/admin/videos/new` 動画登録ページ実装
    - ファイルアップロードコンポーネント
    - 動画タイプ選択
    - プレイヤー選択（複数選択対応）
    - アップロード進捗表示

### 7.3 動画編集機能

- [ ] 動画更新 Server Action 実装
- [ ] `/admin/videos/[id]/edit` 動画編集ページ実装
    - メタデータの編集
    - プレイヤー紐付けの変更
    - ファイル差し替え機能

### 7.4 統合テスト

- [ ] ファイルアップロード・ダウンロードテスト
- [ ] 大容量ファイルでの動作確認

## Phase 8: 品質向上・最適化（2-3日）

### 8.1 エラーハンドリング強化

- [ ] 全APIのエラーレスポンス統一
- [ ] フロントエンドでのエラー表示改善
- [ ] ネットワークエラー時のリトライ機能

### 8.2 パフォーマンス最適化

- [ ] Google Sheets APIの呼び出し最適化
- [ ] データキャッシュ機能実装
- [ ] 画像・ファイルサイズ最適化

### 8.3 ユーザビリティ改善

- [ ] ローディング状態の改善
- [ ] 操作フィードバックの追加
- [ ] レスポンシブデザインの調整

## Phase 9: テスト・デバッグ（1-2日）

### 9.1 総合テスト

- [ ] 全機能のエンドツーエンドテスト
- [ ] 異常系テスト（ファイル不存在、API制限等）
- [ ] 複数ユーザーでの同時アクセステスト

### 9.2 パフォーマンステスト

- [ ] 大量データでの動作確認
- [ ] 大容量ファイルでのテスト
- [ ] モバイルデバイスでの動作確認

## Phase 10: デプロイ・運用準備（1-2日）

### 10.1 本番環境構築

- [ ] AppRun（さくらインターネット）へのデプロイ設定
- [ ] 本番環境用の環境変数設定
- [ ] ドメイン設定（必要に応じて）

### 10.2 運用準備

- [ ] 本番環境での動作確認
- [ ] バックアップ・復旧手順の確立
- [ ] 監視・ログ設定
- [ ] ドキュメント整備
    - 管理者向け操作マニュアル
    - プレイヤー向け利用ガイド
    - トラブルシューティングガイド

---

## 推定工期: 16-22日

## 優先度による段階的リリース案

### MVP版（ユーザー機能のみ）- 8-10日

- Phase 1-4: 基盤・プレイヤー機能
- Phase 10: デプロイ
- **この段階で動画配布サイトとして機能**

### 管理者機能追加版 - 追加6-8日

- Phase 5-7: 管理者機能
- Phase 8: 品質向上

### フル機能版 - 追加2-4日

- Phase 9: テスト・デバッグ

## 各Phaseの依存関係

```
Phase 1 → Phase 2 → Phase 3 → Phase 4
                ↓
Phase 5 → Phase 6
     ↓
Phase 7 → Phase 8 → Phase 9 → Phase 10
```

## 注意事項・リスク

- 各Phase完了時に動作確認を実施
- Google Sheets API制限に注意（キャッシュ戦略必要）
- Cloudflare R2の設定・権限周りの事前確認
- 動画ファイルサイズによるアップロード・ダウンロード時間
- AppRun のデプロイ制限・仕様確認が必要